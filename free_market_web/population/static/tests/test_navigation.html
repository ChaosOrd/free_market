<html>
<head>
  <meta charset="utf-8">
  <title>Javascript tests</title>
  <link rel="stylesheet" href="../../../free_market_web/static/tests/qunit.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit_fixture">
    <form id="id_test_form" method="post">
      <input type="textbox" id="id_first_tb" tabindex="0" />
      <input type="textbox" id="id_second_tb" tabindex="1" />
      <button type="submit" id="id_btn" tabindex="2">Submit</button>
      <select id="some_other_input" tabindex="3" />
      <input id="some_other_text_input", tabindex="4" />
      <input id="input_with_big_tabindex", tabindex="20" />
    </form>
  </div>
</body>
<script src="http://code.jquery.com/jquery.min.js"></script>
<script src="../../../free_market_web/static/tests/qunit.js"></script>
<script src="../navigation.js"></script>
<script>
$(document).ready(function() {
  $('form').submit(function(e) {
    e.preventDefault();
  })
});

function press(key)
{
  var e = $.Event('keypress')
  e.which = key;
  $(document.activeElement).trigger(e);
}

test("an item with tabindex 0 should be focused", function() {
  equal(document.activeElement.id, 'id_first_tb');
});

test("enter should focus on next input if current input is text box", function() {
  $('#id_first_tb').focus();
  press(13);
  equal(document.activeElement.id, 'id_second_tb');
});

test("key other than enter shoud not focus on next input", function() {
  $('#id_first_tb').focus();
  press(43);
  equal(document.activeElement.id, 'id_first_tb');
});

test("enter should focus opn next input if current input is select", function() {
  $('#some_other_input').focus();
  press(13);
  equal(document.activeElement.id, 'some_other_text_input');
});

test("enter should focus on next input if there is a gap in tabindices", function() {
  $('#some_other_text_input').focus();
  press(13);
  equal(document.activeElement.id, 'input_with_big_tabindex');
});

test("IsSubmit should return true when given submit element", function() {
  equal(navigation.IsSubmit($('#id_btn')[0]), true);
});

test("IsSubmit should return false when given textbox element", function() {
  equal(navigation.IsSubmit($('#id_second_tb')[0]), false);
});

test("enter key should not focus if current input is not text box", function() {
  $('#id_btn').focus();
  press(13);
  equal(document.activeElement.id, 'id_btn');
});
</script>
</html>
