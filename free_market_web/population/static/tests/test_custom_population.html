<html>
<head>
  <meta charset="utf-8">
  <title>Javascript tests</title>
  <link rel="stylesheet" href="../../../free_market_web/static/tests/qunit.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit_fixture">
    <form name="universe_form">
      <a id="add_supply" href="#">Add supply</a>
      <a id="add_demand" href="#">Add demand</a>
      <div id="supplies">
      </div>
      <div id="demands">
      </div>
    </form>
  </div>
  <script src="http://code.jquery.com/jquery.min.js"></script>
  <script src="../../../free_market_web/static/tests/qunit.js"></script>
  <script src="../../../free_market_web/static/tests/sinon.js"></script>
  <script src="../custom_population.js"></script>
  <script>

module("custom population", {
  beforeEach: function() {
    sinon.spy(jQuery, 'ajax');
  },
  afterEach: function() {
    jQuery.ajax.restore();
    $('#supplies').html('');
  }
})

test("clicking on add supply should make an ajax request", function() {
  $('#add_supply').trigger("click");
  

  equal(true, jQuery.ajax.calledWithMatch({
    url: 'resource_form',
    type: 'get',
    success: CustomPopulation.addToSupply
    })
  );
});

test("clicking on add demand should make an ajax request", function() {
  $('#add_demand').trigger("click");
  
  equal(true, jQuery.ajax.calledWithMatch({
    url: 'resource_form',
    type: 'get',
    success: CustomPopulation.addToDemand
    })
  );
});

test('CustomPopulation.addToSupply adds contend to supply div', function() {
  $('#supplies').html('before add ')

  CustomPopulation.addToSupply('after add');

  equal($('#supplies').html(), 'before add after add');
});

test('CustomPopulation.addToDemand adds contend to demand div', function() {
  $('#demands').html('before add ')

  CustomPopulation.addToDemand('after add');

  equal($('#demands').html(), 'before add after add');
});
  </script>
</body>
</html>
